---
title: 'Capítulo 7: Análisis exploratorio de datos de microbiomas'
author:
 - Andrés Arredondo (email_1@gmail.com)
 - Adriana Haydé Contreras Peruyero (haydeeperuyero@gmail.com)
 - David Alberto García Estrada (@gmail.com)
date: "`r Sys.Date()`"
output: html_document
---


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```

# Datos de Ratones y Humanos

Las bases de datos que se ocuparon son dos:

  - Vdr: es una base de datos de ratones. Contiene datos de microbiomas intestinales y fueron recolectados de heces y muestras de heces cecales. Las que se usan en este capítulo son de heces.
  - Troat.otu.tab: estos datos son de fumadores y se encuentran en el paquete `GUniFrac`. Estos datos se usarán para explorar el árbol filogenético.
  
  
# Análisis exploratorio con resumen gráfico

En este capítulo se exploran diferentes gráficos usuales: riquesa, barras de abundancia, mapas de calor, redes y árbol filogenético.

## Gráficos de riqueza

En el capítulo anterior se exploró la diversidad alfa, en este capítulo vamos a explorar un gráfico relacionado a esto. Para esto, se usa la función `plot_richness()` del paquete `phyloseq`. Generalmente, la riqueza se refiere a un gráfico del número toal de especies, taxones u OTUs en un ambiente, pero está función también nos da otras figuras relacionadas a otras diversidades. 

Lo primero que debemos hacer es instalar el paquete y leer los datos.

```{r}
#Para instalar el paquete, usamos Bioconductor

#if (!require("BiocManager", quietly = TRUE))
 # install.packages("BiocManager")

#BiocManager::install("phyloseq")
```

En la carpeta `data` se encuentra la base de datos a usar `VdrFecalGenusCounts.csv`.

```{r}
setwd("D:/Users/hayde/Documents/R_sites/Equipo4")
```

```{r}
library(phyloseq)
library(ggplot2)
abund_table=read.csv("D:/Users/hayde/Documents/R_sites/Equipo4/data/VdrFecalGenusCounts.csv",row.names=1,check.names=FALSE)
abund_table<-t(abund_table)
```

Lo primero que se debe de hacer es contruir nuestro objeto `phyloseq`. Este objeto se contruye tomando en cuenta los siguientes componentes:
  - Tabla OTU.
  - Datos muestra.
  - Tabla de taxonomía.
  - Árbol filogenético.

Se deben de proporcionar dos objetos de datos pero el orden en que se proporcionan no es importante. Construimos primero nuestra tabla de metadatos con los siguientes comandos.

```{r}
meta_table <- data.frame(row.names=rownames(abund_table),t(as.data.frame(strsplit(rownames(abund_table),"_"))))
meta_table$Group <- with(meta_table,ifelse(as.factor(X2)%in% c(11,12,13,14,15),c("Vdr-/-"), c("WT")))
```

Convertimos los datos al formato `phyloseq`.

```{r}
OTU = otu_table(as.matrix(abund_table), taxa_are_rows = FALSE)
SAM = sample_data(meta_table)
physeq <- merge_phyloseq(phyloseq(OTU),SAM)
physeq
```
Una vez que tenemos nuestro objeto `phyloseq`, podemos usar la función `plot_richness()` para contruir graficar las diversidades alpha observadas y estimadas.

```{r, include = TRUE, echo = FALSE, fig.pos = 'H', fig.dim = c(12,8), fig.align = "center", message=FALSE, fig.cap = 'Gráficos de diversidad alpha con Vdr y grupos WT en muestras de heces.'}
plot_richness(physeq, x = "Group ", color = "Group ")
```

Esta función también nos permite seleccionar solo algunas diversidades. El siguiente es un ejemplo usando solo dos diversidades, la de Chao1 y Shannon.

```{r, include = TRUE, echo = FALSE, fig.pos = 'H', fig.dim = c(12,8), fig.align = "center", message=FALSE, fig.cap = 'Gráficos de diversidad alpha seleccionando las diversidades de Chao y Shannon.' }

plot_richness(physeq, measures = c("Chao1", "Shannon"),x = "Group ", color = "Group ")
```

## Barras de abundancia

La herramienta de `phyloseq` que nos permite graficar las barras de abundancia es `plot_bar()`.


## Mapas de calor

## Redes

## Árbol filogenético

# Clusters

## Distancias

## Diferentes tipos de clústers

### Single

### Complete

### Average

### Ward

# Ordination

## PCA

## PCoA

## NMDS

## CA

## RDA

## CCA

## CAP

# Conlusiones






